name: CI
on:
  push:
    branches: [ "win" ]
  pull_request:
    branches: [ "win" ]
env:
  ANDROID_NDK_VERSION: r25b

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Setup dependencies
        run: |
          cd C:\
          git clone --depth=1 --recurse-submodules https://github.com/frida/frida
      - uses: ilammy/msvc-dev-cmd@v1
        with:
          arch: amd64
          toolset: 14.3
      - name: Build
        run: |
          cd C:\frida
          ls
          msbuild frida.sln /p:Configuration=Release /p:Platform=x64
          ls
      # - name: Package Directories
      #   run: |
      #     mv /home/runner/work/frida/build/frida-android-arm/bin/frida-server modfda
      #     7z a android_modfda_arm.7z modfda
      #     rm modfda
      #     mv /home/runner/work/frida/build/frida-android-arm64/bin/frida-server modfda
      #     7z a android_modfda_arm64.7z modfda
      #     rm modfda
      #     mv /home/runner/work/frida/build/frida-android-x86/bin/frida-server modfda
      #     7z a android_modfda_x86.7z modfda
      #     rm modfda
      #     mv /home/runner/work/frida/build/frida-android-x86_64/bin/frida-server modfda
      #     7z a android_modfda_x86_64.7z modfda
      # - name: Update modfda Release
      #   uses: softprops/action-gh-release@v1
      #   with:
      #     tag_name: win-build
      #     body: 'Frida 16.0.19'
      #     files: |
      #       android_modfda_arm.7z
      #       android_modfda_arm64.7z
      #       android_modfda_x86.7z
      #       android_modfda_x86_64.7z
